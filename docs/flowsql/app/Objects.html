<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>flowsql.app.Objects API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>flowsql.app.Objects</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import pprint


class Object:
    object_counter = 1000

    def __init__(self, sid):
        # String ID
        self.sid = sid
        # Numerical ID
        self.nid = Object.object_counter
        Object.object_counter += 1


class Schema(Object):
    def __init__(self, sid: str):
        Object.__init__(self, sid)
        self.name = sid


class Table(Object):
    def __init__(self, sid: str, schema_sid: str):
        Object.__init__(self, sid)
        self.schema_sid = schema_sid
        self.name = sid.split(&#34;.&#34;)[1]
        self.max_text_length = len(self.name)
        self.num_columns = 0
        self.num_children = 0
        self.num_parents = 0


class Column(Object):
    def __init__(self, sid: str, table_sid: str):
        Object.__init__(self, sid)
        self.table_sid = table_sid
        self.name = sid.split(&#34;.&#34;)[2]


class Link(Object):
    def __init__(self, source_col_sid: str, target_col_sid: str):
        Object.__init__(self, sid=None)
        self.source_sid = source_col_sid
        self.target_sid = target_col_sid


class ObjectCollection:
    def __init__(self):
        self._schemas = {}

        # Schema lookup. The key (schema_sid) returns a list of tables (table_sids).
        self._schema_tables_lookup = {}
        self._tables = {}
        self._table_columns_lookup = {}
        self._columns = {}
        # Target columns mapping to links
        self._column_links_lookup = {}
        self._links = {}

    def add_schema(self, sid: str):
        print(sid, self._schema_tables_lookup)
        if sid in self._schema_tables_lookup:
            return
        new_schema = Schema(sid=sid)
        self._schemas[sid] = new_schema
        self._schema_tables_lookup[sid] = []

    def add_table(self, sid: str, schema_sid: int):
        if sid in self._table_columns_lookup:
            return
        new_table = Table(sid=sid, schema_sid=schema_sid)
        self._tables[sid] = new_table

        # Append table sid to the schema-&gt;tables lookup
        self._schema_tables_lookup[schema_sid].append(sid)
        # Create empty table-&gt;cols lookup
        self._table_columns_lookup[sid] = []

    def add_column(self, sid: str, table_sid: int):
        if sid in self._column_links_lookup:
            return
        new_column = Column(sid=sid, table_sid=table_sid)
        self._columns[sid] = new_column

        self._tables[table_sid].num_columns += 1

        column_name_len = len(sid.split(&#34;.&#34;)[2])
        if column_name_len &gt; self._tables[table_sid].max_text_length:
            self._tables[table_sid].max_text_length = column_name_len

        # Append column sid to the table-&gt;columns lookup
        self._table_columns_lookup[table_sid].append(sid)
        # Create empty col-&gt;links lookup
        self._column_links_lookup[sid] = []

    def add_link(self, source_col_sid: int, target_col_sid: int):
        new_link = Link(source_col_sid=source_col_sid, target_col_sid=target_col_sid)
        self._links[new_link.nid] = new_link

        # Append link sid to the target_col-&gt;links lookup
        self._column_links_lookup[target_col_sid].append(new_link.nid)

        # Increment num_parents and num_children accordingly
        source_table_sid = self._columns[source_col_sid].table_sid
        target_table_sid = self._columns[target_col_sid].table_sid

        self._tables[source_table_sid].num_children += 1
        self._tables[target_table_sid].num_parents += 1

    def print_snapshot(self, how=&#34;pretty&#34;):
        def pretty_print_snapshot(snapshot=self.snapshot):

            line_breaks = 3
            schema_offset = 2
            table_offset = 3
            whole_line = 100
            column_width = (whole_line - table_offset) // 2

            def print_line(type=None, text=&#34;&#34;, source_sid=None, target_sid=None):

                if type == &#34;schema&#34;:
                    print(&#34;\n&#34; * line_breaks)
                    print(&#34; &#34; * schema_offset + &#34;#&#34; * whole_line)
                    buffer = 3
                    offset = len(text) // 2
                    print(&#34; &#34; * schema_offset + &#34; &#34; * (column_width - offset) + text)
                    print(&#34; &#34; * schema_offset + &#34;#&#34; * whole_line)

                elif type == &#34;table&#34;:
                    print()
                    print(&#34; &#34; * table_offset + &#34;+&#34; + &#34;-&#34; * column_width * 2 + &#34;+&#34;)
                    offset = len(text) // 2
                    print(
                        &#34; &#34; * table_offset
                        + &#34;|&#34;
                        + &#34; &#34; * (column_width - offset)
                        + text
                        + &#34; &#34; * (column_width - (len(text) - offset))
                        + &#34;|&#34;
                    )
                    print(&#34; &#34; * table_offset + &#34;+&#34; + &#34;-&#34; * column_width * 2 + &#34;+&#34;)

                elif type == &#34;link&#34;:
                    print(
                        &#34; &#34; * table_offset
                        + &#34;|&#34;
                        + source_sid
                        + &#34; &#34; * (column_width - len(source_sid) - 2)
                        + &#34;-&gt;&#34;
                        + &#34; &#34; * (column_width - len(target_sid))
                        + target_sid
                        + &#34;|&#34;
                    )
                    print(&#34; &#34; * table_offset + &#34;+&#34; + &#34;-&#34; * column_width * 2 + &#34;+&#34;)

            for schema in snapshot:
                schema_sid = schema[&#34;name&#34;]
                print_line(type=&#34;schema&#34;, text=schema_sid)

                for table in schema[&#34;tables&#34;]:
                    table_sid = table[&#34;name&#34;]
                    print_line(type=&#34;table&#34;, text=table_sid)

                    for column in table[&#34;cols&#34;]:
                        column_sid = column[&#34;name&#34;]

                        links = column[&#34;links&#34;]

                        if links == []:
                            print_line(
                                type=&#34;link&#34;, source_sid=&#34;&#34;, target_sid=column_sid
                            )

                        else:
                            for link in links:
                                print_line(
                                    type=&#34;link&#34;,
                                    source_sid=self._links[link[&#34;link_id&#34;]].source_sid,
                                    target_sid=self._links[link[&#34;link_id&#34;]].target_sid,
                                )

            print(&#34;\n&#34; * line_breaks)

        if how == &#34;raw&#34;:
            pprint.pprint(self.snapshot)
        elif how == &#34;pretty&#34;:
            pretty_print_snapshot()

    def create_snapshot(self):
        &#34;&#34;&#34;
        snapshot is the desired end state. This is what is used as an input to Jinja to create the
        draw.io diagram.
        snapshot = [
            {
                &#39;name&#39;:&#39;stage.reference_rts&#39;,
                &#39;id&#39;:3,
                &#39;x&#39;:900,
                &#39;cols&#39;:[
                    {
                        &#39;name&#39;:&#39;region&#39;,
                        &#39;id&#39;:301,
                        &#39;y&#39;:26,
                        &#39;links&#39;:[]
                    },
                    {
                        &#39;name&#39;:&#39;county&#39;,
                        &#39;id&#39;:302,
                        &#39;y&#39;:52,
                        &#39;links&#39;:[{
                                &#39;link_id&#39;:900,
                                &#39;parent_id&#39;:402
                            }]
                    },
                    {
                        &#39;name&#39;:&#39;indoor_outdoor&#39;,
                        &#39;id&#39;:303,
                        &#39;y&#39;:78,
                        &#39;links&#39;:[]
                    }
                ]
            },
            {
                &#39;name&#39;:&#39;reporting.reference_postcode&#39;,
                &#39;id&#39;:4,
                &#39;x&#39;: 300,
                &#39;cols&#39;:[
                    {
                        &#39;name&#39;:&#39;region_name&#39;,
                        &#39;id&#39;:401,
                        &#39;y&#39;:26,
                        &#39;links&#39;:[]
                    },
                    {
                        &#39;name&#39;:&#39;county_name&#39;,
                        &#39;id&#39;:402,
                        &#39;y&#39;:52,
                        &#39;links&#39;:[]
                    }
                ]
            }
        ]
        &#34;&#34;&#34;

        def determine_table_ordering():
            # order tables and links
            ordering_dict = {}
            for table_sid, table in self._tables.items():
                ordering_dict[table_sid] = {
                    &#34;net_parent&#34;: table.num_parents - table.num_children
                }

            # sort by no. parents, then no. children; note the lambda uses a tuple
            order = 0
            for table_sid in sorted(
                ordering_dict,
                key=lambda k: (ordering_dict[k][&#34;net_parent&#34;]),
            ):
                self._tables[table_sid].order = order
                order += 1

        def create_snapshot():
            snapshot = []
            x_delta = 400
            y_delta = 150
            row_height = 26
            width_per_text_length = 8

            num_per_column = 2

            for schema_sid, table_sids in self._schema_tables_lookup.items():
                schema = self._schemas[schema_sid]
                schema_snapshot = {
                    &#34;name&#34;: schema.sid,
                    &#34;id&#34;: schema.nid,
                    &#34;x&#34;: 0,
                    &#34;y&#34;: 0,
                    &#34;height&#34;: 100,
                    &#34;width&#34;: 100,
                    &#34;tables&#34;: [],
                }

                for table_sid in table_sids:

                    table = self._tables[table_sid]
                    table_snapshot = {
                        &#34;name&#34;: table.name,
                        &#34;id&#34;: table.nid,
                        &#34;order&#34;: table.order,
                        &#34;height&#34;: (table.num_columns + 1) * row_height,
                        &#34;width&#34;: table.max_text_length * width_per_text_length,
                        &#34;x&#34;: x_delta + ((table.order // num_per_column) * x_delta),
                        &#34;y&#34;: y_delta + ((table.order % num_per_column) * y_delta),
                        &#34;cols&#34;: [],
                    }

                    column_counter = 1
                    link_counter = 1

                    for column_sid in self._table_columns_lookup[table_sid]:

                        column = self._columns[column_sid]
                        column_snapshot = {
                            &#34;name&#34;: column.name,
                            &#34;id&#34;: column.nid,
                            &#34;width&#34;: table_snapshot[&#34;width&#34;],
                            &#34;height&#34;: row_height,
                            &#34;y&#34;: column_counter * row_height,
                            &#34;links&#34;: [],
                        }

                        link_nids = self._column_links_lookup[column_sid]
                        for link_nid in link_nids:
                            link = self._links[link_nid]
                            link_snapshot = {
                                &#34;link_id&#34;: link_nid,
                                &#34;parent_id&#34;: self._columns[link.source_sid].nid,
                                &#34;mx&#34;: table_snapshot[&#34;x&#34;] - (link_counter * 26),
                                &#34;my&#34;: table_snapshot[&#34;y&#34;] + column_snapshot[&#34;y&#34;],
                            }
                            column_snapshot[&#34;links&#34;].append(link_snapshot)
                            link_counter += 1

                        table_snapshot[&#34;cols&#34;].append(column_snapshot)
                        column_counter += 1

                    schema_snapshot[&#34;tables&#34;].append(table_snapshot)

                snapshot.append(schema_snapshot)

            return snapshot

        determine_table_ordering()
        self.snapshot = create_snapshot()
        self.print_snapshot(how=&#34;raw&#34;)
        self.print_snapshot(how=&#34;pretty&#34;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="flowsql.app.Objects.Column"><code class="flex name class">
<span>class <span class="ident">Column</span></span>
<span>(</span><span>sid: str, table_sid: str)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Column(Object):
    def __init__(self, sid: str, table_sid: str):
        Object.__init__(self, sid)
        self.table_sid = table_sid
        self.name = sid.split(&#34;.&#34;)[2]</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="flowsql.app.Objects.Object" href="#flowsql.app.Objects.Object">Object</a></li>
</ul>
</dd>
<dt id="flowsql.app.Objects.Link"><code class="flex name class">
<span>class <span class="ident">Link</span></span>
<span>(</span><span>source_col_sid: str, target_col_sid: str)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Link(Object):
    def __init__(self, source_col_sid: str, target_col_sid: str):
        Object.__init__(self, sid=None)
        self.source_sid = source_col_sid
        self.target_sid = target_col_sid</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="flowsql.app.Objects.Object" href="#flowsql.app.Objects.Object">Object</a></li>
</ul>
</dd>
<dt id="flowsql.app.Objects.Object"><code class="flex name class">
<span>class <span class="ident">Object</span></span>
<span>(</span><span>sid)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Object:
    object_counter = 1000

    def __init__(self, sid):
        # String ID
        self.sid = sid
        # Numerical ID
        self.nid = Object.object_counter
        Object.object_counter += 1</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="flowsql.app.Objects.Column" href="#flowsql.app.Objects.Column">Column</a></li>
<li><a title="flowsql.app.Objects.Link" href="#flowsql.app.Objects.Link">Link</a></li>
<li><a title="flowsql.app.Objects.Schema" href="#flowsql.app.Objects.Schema">Schema</a></li>
<li><a title="flowsql.app.Objects.Table" href="#flowsql.app.Objects.Table">Table</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="flowsql.app.Objects.Object.object_counter"><code class="name">var <span class="ident">object_counter</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="flowsql.app.Objects.ObjectCollection"><code class="flex name class">
<span>class <span class="ident">ObjectCollection</span></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ObjectCollection:
    def __init__(self):
        self._schemas = {}

        # Schema lookup. The key (schema_sid) returns a list of tables (table_sids).
        self._schema_tables_lookup = {}
        self._tables = {}
        self._table_columns_lookup = {}
        self._columns = {}
        # Target columns mapping to links
        self._column_links_lookup = {}
        self._links = {}

    def add_schema(self, sid: str):
        print(sid, self._schema_tables_lookup)
        if sid in self._schema_tables_lookup:
            return
        new_schema = Schema(sid=sid)
        self._schemas[sid] = new_schema
        self._schema_tables_lookup[sid] = []

    def add_table(self, sid: str, schema_sid: int):
        if sid in self._table_columns_lookup:
            return
        new_table = Table(sid=sid, schema_sid=schema_sid)
        self._tables[sid] = new_table

        # Append table sid to the schema-&gt;tables lookup
        self._schema_tables_lookup[schema_sid].append(sid)
        # Create empty table-&gt;cols lookup
        self._table_columns_lookup[sid] = []

    def add_column(self, sid: str, table_sid: int):
        if sid in self._column_links_lookup:
            return
        new_column = Column(sid=sid, table_sid=table_sid)
        self._columns[sid] = new_column

        self._tables[table_sid].num_columns += 1

        column_name_len = len(sid.split(&#34;.&#34;)[2])
        if column_name_len &gt; self._tables[table_sid].max_text_length:
            self._tables[table_sid].max_text_length = column_name_len

        # Append column sid to the table-&gt;columns lookup
        self._table_columns_lookup[table_sid].append(sid)
        # Create empty col-&gt;links lookup
        self._column_links_lookup[sid] = []

    def add_link(self, source_col_sid: int, target_col_sid: int):
        new_link = Link(source_col_sid=source_col_sid, target_col_sid=target_col_sid)
        self._links[new_link.nid] = new_link

        # Append link sid to the target_col-&gt;links lookup
        self._column_links_lookup[target_col_sid].append(new_link.nid)

        # Increment num_parents and num_children accordingly
        source_table_sid = self._columns[source_col_sid].table_sid
        target_table_sid = self._columns[target_col_sid].table_sid

        self._tables[source_table_sid].num_children += 1
        self._tables[target_table_sid].num_parents += 1

    def print_snapshot(self, how=&#34;pretty&#34;):
        def pretty_print_snapshot(snapshot=self.snapshot):

            line_breaks = 3
            schema_offset = 2
            table_offset = 3
            whole_line = 100
            column_width = (whole_line - table_offset) // 2

            def print_line(type=None, text=&#34;&#34;, source_sid=None, target_sid=None):

                if type == &#34;schema&#34;:
                    print(&#34;\n&#34; * line_breaks)
                    print(&#34; &#34; * schema_offset + &#34;#&#34; * whole_line)
                    buffer = 3
                    offset = len(text) // 2
                    print(&#34; &#34; * schema_offset + &#34; &#34; * (column_width - offset) + text)
                    print(&#34; &#34; * schema_offset + &#34;#&#34; * whole_line)

                elif type == &#34;table&#34;:
                    print()
                    print(&#34; &#34; * table_offset + &#34;+&#34; + &#34;-&#34; * column_width * 2 + &#34;+&#34;)
                    offset = len(text) // 2
                    print(
                        &#34; &#34; * table_offset
                        + &#34;|&#34;
                        + &#34; &#34; * (column_width - offset)
                        + text
                        + &#34; &#34; * (column_width - (len(text) - offset))
                        + &#34;|&#34;
                    )
                    print(&#34; &#34; * table_offset + &#34;+&#34; + &#34;-&#34; * column_width * 2 + &#34;+&#34;)

                elif type == &#34;link&#34;:
                    print(
                        &#34; &#34; * table_offset
                        + &#34;|&#34;
                        + source_sid
                        + &#34; &#34; * (column_width - len(source_sid) - 2)
                        + &#34;-&gt;&#34;
                        + &#34; &#34; * (column_width - len(target_sid))
                        + target_sid
                        + &#34;|&#34;
                    )
                    print(&#34; &#34; * table_offset + &#34;+&#34; + &#34;-&#34; * column_width * 2 + &#34;+&#34;)

            for schema in snapshot:
                schema_sid = schema[&#34;name&#34;]
                print_line(type=&#34;schema&#34;, text=schema_sid)

                for table in schema[&#34;tables&#34;]:
                    table_sid = table[&#34;name&#34;]
                    print_line(type=&#34;table&#34;, text=table_sid)

                    for column in table[&#34;cols&#34;]:
                        column_sid = column[&#34;name&#34;]

                        links = column[&#34;links&#34;]

                        if links == []:
                            print_line(
                                type=&#34;link&#34;, source_sid=&#34;&#34;, target_sid=column_sid
                            )

                        else:
                            for link in links:
                                print_line(
                                    type=&#34;link&#34;,
                                    source_sid=self._links[link[&#34;link_id&#34;]].source_sid,
                                    target_sid=self._links[link[&#34;link_id&#34;]].target_sid,
                                )

            print(&#34;\n&#34; * line_breaks)

        if how == &#34;raw&#34;:
            pprint.pprint(self.snapshot)
        elif how == &#34;pretty&#34;:
            pretty_print_snapshot()

    def create_snapshot(self):
        &#34;&#34;&#34;
        snapshot is the desired end state. This is what is used as an input to Jinja to create the
        draw.io diagram.
        snapshot = [
            {
                &#39;name&#39;:&#39;stage.reference_rts&#39;,
                &#39;id&#39;:3,
                &#39;x&#39;:900,
                &#39;cols&#39;:[
                    {
                        &#39;name&#39;:&#39;region&#39;,
                        &#39;id&#39;:301,
                        &#39;y&#39;:26,
                        &#39;links&#39;:[]
                    },
                    {
                        &#39;name&#39;:&#39;county&#39;,
                        &#39;id&#39;:302,
                        &#39;y&#39;:52,
                        &#39;links&#39;:[{
                                &#39;link_id&#39;:900,
                                &#39;parent_id&#39;:402
                            }]
                    },
                    {
                        &#39;name&#39;:&#39;indoor_outdoor&#39;,
                        &#39;id&#39;:303,
                        &#39;y&#39;:78,
                        &#39;links&#39;:[]
                    }
                ]
            },
            {
                &#39;name&#39;:&#39;reporting.reference_postcode&#39;,
                &#39;id&#39;:4,
                &#39;x&#39;: 300,
                &#39;cols&#39;:[
                    {
                        &#39;name&#39;:&#39;region_name&#39;,
                        &#39;id&#39;:401,
                        &#39;y&#39;:26,
                        &#39;links&#39;:[]
                    },
                    {
                        &#39;name&#39;:&#39;county_name&#39;,
                        &#39;id&#39;:402,
                        &#39;y&#39;:52,
                        &#39;links&#39;:[]
                    }
                ]
            }
        ]
        &#34;&#34;&#34;

        def determine_table_ordering():
            # order tables and links
            ordering_dict = {}
            for table_sid, table in self._tables.items():
                ordering_dict[table_sid] = {
                    &#34;net_parent&#34;: table.num_parents - table.num_children
                }

            # sort by no. parents, then no. children; note the lambda uses a tuple
            order = 0
            for table_sid in sorted(
                ordering_dict,
                key=lambda k: (ordering_dict[k][&#34;net_parent&#34;]),
            ):
                self._tables[table_sid].order = order
                order += 1

        def create_snapshot():
            snapshot = []
            x_delta = 400
            y_delta = 150
            row_height = 26
            width_per_text_length = 8

            num_per_column = 2

            for schema_sid, table_sids in self._schema_tables_lookup.items():
                schema = self._schemas[schema_sid]
                schema_snapshot = {
                    &#34;name&#34;: schema.sid,
                    &#34;id&#34;: schema.nid,
                    &#34;x&#34;: 0,
                    &#34;y&#34;: 0,
                    &#34;height&#34;: 100,
                    &#34;width&#34;: 100,
                    &#34;tables&#34;: [],
                }

                for table_sid in table_sids:

                    table = self._tables[table_sid]
                    table_snapshot = {
                        &#34;name&#34;: table.name,
                        &#34;id&#34;: table.nid,
                        &#34;order&#34;: table.order,
                        &#34;height&#34;: (table.num_columns + 1) * row_height,
                        &#34;width&#34;: table.max_text_length * width_per_text_length,
                        &#34;x&#34;: x_delta + ((table.order // num_per_column) * x_delta),
                        &#34;y&#34;: y_delta + ((table.order % num_per_column) * y_delta),
                        &#34;cols&#34;: [],
                    }

                    column_counter = 1
                    link_counter = 1

                    for column_sid in self._table_columns_lookup[table_sid]:

                        column = self._columns[column_sid]
                        column_snapshot = {
                            &#34;name&#34;: column.name,
                            &#34;id&#34;: column.nid,
                            &#34;width&#34;: table_snapshot[&#34;width&#34;],
                            &#34;height&#34;: row_height,
                            &#34;y&#34;: column_counter * row_height,
                            &#34;links&#34;: [],
                        }

                        link_nids = self._column_links_lookup[column_sid]
                        for link_nid in link_nids:
                            link = self._links[link_nid]
                            link_snapshot = {
                                &#34;link_id&#34;: link_nid,
                                &#34;parent_id&#34;: self._columns[link.source_sid].nid,
                                &#34;mx&#34;: table_snapshot[&#34;x&#34;] - (link_counter * 26),
                                &#34;my&#34;: table_snapshot[&#34;y&#34;] + column_snapshot[&#34;y&#34;],
                            }
                            column_snapshot[&#34;links&#34;].append(link_snapshot)
                            link_counter += 1

                        table_snapshot[&#34;cols&#34;].append(column_snapshot)
                        column_counter += 1

                    schema_snapshot[&#34;tables&#34;].append(table_snapshot)

                snapshot.append(schema_snapshot)

            return snapshot

        determine_table_ordering()
        self.snapshot = create_snapshot()
        self.print_snapshot(how=&#34;raw&#34;)
        self.print_snapshot(how=&#34;pretty&#34;)</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="flowsql.app.Objects.ObjectCollection.add_column"><code class="name flex">
<span>def <span class="ident">add_column</span></span>(<span>self, sid: str, table_sid: int)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_column(self, sid: str, table_sid: int):
    if sid in self._column_links_lookup:
        return
    new_column = Column(sid=sid, table_sid=table_sid)
    self._columns[sid] = new_column

    self._tables[table_sid].num_columns += 1

    column_name_len = len(sid.split(&#34;.&#34;)[2])
    if column_name_len &gt; self._tables[table_sid].max_text_length:
        self._tables[table_sid].max_text_length = column_name_len

    # Append column sid to the table-&gt;columns lookup
    self._table_columns_lookup[table_sid].append(sid)
    # Create empty col-&gt;links lookup
    self._column_links_lookup[sid] = []</code></pre>
</details>
</dd>
<dt id="flowsql.app.Objects.ObjectCollection.add_link"><code class="name flex">
<span>def <span class="ident">add_link</span></span>(<span>self, source_col_sid: int, target_col_sid: int)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_link(self, source_col_sid: int, target_col_sid: int):
    new_link = Link(source_col_sid=source_col_sid, target_col_sid=target_col_sid)
    self._links[new_link.nid] = new_link

    # Append link sid to the target_col-&gt;links lookup
    self._column_links_lookup[target_col_sid].append(new_link.nid)

    # Increment num_parents and num_children accordingly
    source_table_sid = self._columns[source_col_sid].table_sid
    target_table_sid = self._columns[target_col_sid].table_sid

    self._tables[source_table_sid].num_children += 1
    self._tables[target_table_sid].num_parents += 1</code></pre>
</details>
</dd>
<dt id="flowsql.app.Objects.ObjectCollection.add_schema"><code class="name flex">
<span>def <span class="ident">add_schema</span></span>(<span>self, sid: str)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_schema(self, sid: str):
    print(sid, self._schema_tables_lookup)
    if sid in self._schema_tables_lookup:
        return
    new_schema = Schema(sid=sid)
    self._schemas[sid] = new_schema
    self._schema_tables_lookup[sid] = []</code></pre>
</details>
</dd>
<dt id="flowsql.app.Objects.ObjectCollection.add_table"><code class="name flex">
<span>def <span class="ident">add_table</span></span>(<span>self, sid: str, schema_sid: int)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_table(self, sid: str, schema_sid: int):
    if sid in self._table_columns_lookup:
        return
    new_table = Table(sid=sid, schema_sid=schema_sid)
    self._tables[sid] = new_table

    # Append table sid to the schema-&gt;tables lookup
    self._schema_tables_lookup[schema_sid].append(sid)
    # Create empty table-&gt;cols lookup
    self._table_columns_lookup[sid] = []</code></pre>
</details>
</dd>
<dt id="flowsql.app.Objects.ObjectCollection.create_snapshot"><code class="name flex">
<span>def <span class="ident">create_snapshot</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>snapshot is the desired end state. This is what is used as an input to Jinja to create the
draw.io diagram.
snapshot = [
{
'name':'stage.reference_rts',
'id':3,
'x':900,
'cols':[
{
'name':'region',
'id':301,
'y':26,
'links':[]
},
{
'name':'county',
'id':302,
'y':52,
'links':[{
'link_id':900,
'parent_id':402
}]
},
{
'name':'indoor_outdoor',
'id':303,
'y':78,
'links':[]
}
]
},
{
'name':'reporting.reference_postcode',
'id':4,
'x': 300,
'cols':[
{
'name':'region_name',
'id':401,
'y':26,
'links':[]
},
{
'name':'county_name',
'id':402,
'y':52,
'links':[]
}
]
}
]</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_snapshot(self):
    &#34;&#34;&#34;
    snapshot is the desired end state. This is what is used as an input to Jinja to create the
    draw.io diagram.
    snapshot = [
        {
            &#39;name&#39;:&#39;stage.reference_rts&#39;,
            &#39;id&#39;:3,
            &#39;x&#39;:900,
            &#39;cols&#39;:[
                {
                    &#39;name&#39;:&#39;region&#39;,
                    &#39;id&#39;:301,
                    &#39;y&#39;:26,
                    &#39;links&#39;:[]
                },
                {
                    &#39;name&#39;:&#39;county&#39;,
                    &#39;id&#39;:302,
                    &#39;y&#39;:52,
                    &#39;links&#39;:[{
                            &#39;link_id&#39;:900,
                            &#39;parent_id&#39;:402
                        }]
                },
                {
                    &#39;name&#39;:&#39;indoor_outdoor&#39;,
                    &#39;id&#39;:303,
                    &#39;y&#39;:78,
                    &#39;links&#39;:[]
                }
            ]
        },
        {
            &#39;name&#39;:&#39;reporting.reference_postcode&#39;,
            &#39;id&#39;:4,
            &#39;x&#39;: 300,
            &#39;cols&#39;:[
                {
                    &#39;name&#39;:&#39;region_name&#39;,
                    &#39;id&#39;:401,
                    &#39;y&#39;:26,
                    &#39;links&#39;:[]
                },
                {
                    &#39;name&#39;:&#39;county_name&#39;,
                    &#39;id&#39;:402,
                    &#39;y&#39;:52,
                    &#39;links&#39;:[]
                }
            ]
        }
    ]
    &#34;&#34;&#34;

    def determine_table_ordering():
        # order tables and links
        ordering_dict = {}
        for table_sid, table in self._tables.items():
            ordering_dict[table_sid] = {
                &#34;net_parent&#34;: table.num_parents - table.num_children
            }

        # sort by no. parents, then no. children; note the lambda uses a tuple
        order = 0
        for table_sid in sorted(
            ordering_dict,
            key=lambda k: (ordering_dict[k][&#34;net_parent&#34;]),
        ):
            self._tables[table_sid].order = order
            order += 1

    def create_snapshot():
        snapshot = []
        x_delta = 400
        y_delta = 150
        row_height = 26
        width_per_text_length = 8

        num_per_column = 2

        for schema_sid, table_sids in self._schema_tables_lookup.items():
            schema = self._schemas[schema_sid]
            schema_snapshot = {
                &#34;name&#34;: schema.sid,
                &#34;id&#34;: schema.nid,
                &#34;x&#34;: 0,
                &#34;y&#34;: 0,
                &#34;height&#34;: 100,
                &#34;width&#34;: 100,
                &#34;tables&#34;: [],
            }

            for table_sid in table_sids:

                table = self._tables[table_sid]
                table_snapshot = {
                    &#34;name&#34;: table.name,
                    &#34;id&#34;: table.nid,
                    &#34;order&#34;: table.order,
                    &#34;height&#34;: (table.num_columns + 1) * row_height,
                    &#34;width&#34;: table.max_text_length * width_per_text_length,
                    &#34;x&#34;: x_delta + ((table.order // num_per_column) * x_delta),
                    &#34;y&#34;: y_delta + ((table.order % num_per_column) * y_delta),
                    &#34;cols&#34;: [],
                }

                column_counter = 1
                link_counter = 1

                for column_sid in self._table_columns_lookup[table_sid]:

                    column = self._columns[column_sid]
                    column_snapshot = {
                        &#34;name&#34;: column.name,
                        &#34;id&#34;: column.nid,
                        &#34;width&#34;: table_snapshot[&#34;width&#34;],
                        &#34;height&#34;: row_height,
                        &#34;y&#34;: column_counter * row_height,
                        &#34;links&#34;: [],
                    }

                    link_nids = self._column_links_lookup[column_sid]
                    for link_nid in link_nids:
                        link = self._links[link_nid]
                        link_snapshot = {
                            &#34;link_id&#34;: link_nid,
                            &#34;parent_id&#34;: self._columns[link.source_sid].nid,
                            &#34;mx&#34;: table_snapshot[&#34;x&#34;] - (link_counter * 26),
                            &#34;my&#34;: table_snapshot[&#34;y&#34;] + column_snapshot[&#34;y&#34;],
                        }
                        column_snapshot[&#34;links&#34;].append(link_snapshot)
                        link_counter += 1

                    table_snapshot[&#34;cols&#34;].append(column_snapshot)
                    column_counter += 1

                schema_snapshot[&#34;tables&#34;].append(table_snapshot)

            snapshot.append(schema_snapshot)

        return snapshot

    determine_table_ordering()
    self.snapshot = create_snapshot()
    self.print_snapshot(how=&#34;raw&#34;)
    self.print_snapshot(how=&#34;pretty&#34;)</code></pre>
</details>
</dd>
<dt id="flowsql.app.Objects.ObjectCollection.print_snapshot"><code class="name flex">
<span>def <span class="ident">print_snapshot</span></span>(<span>self, how='pretty')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def print_snapshot(self, how=&#34;pretty&#34;):
    def pretty_print_snapshot(snapshot=self.snapshot):

        line_breaks = 3
        schema_offset = 2
        table_offset = 3
        whole_line = 100
        column_width = (whole_line - table_offset) // 2

        def print_line(type=None, text=&#34;&#34;, source_sid=None, target_sid=None):

            if type == &#34;schema&#34;:
                print(&#34;\n&#34; * line_breaks)
                print(&#34; &#34; * schema_offset + &#34;#&#34; * whole_line)
                buffer = 3
                offset = len(text) // 2
                print(&#34; &#34; * schema_offset + &#34; &#34; * (column_width - offset) + text)
                print(&#34; &#34; * schema_offset + &#34;#&#34; * whole_line)

            elif type == &#34;table&#34;:
                print()
                print(&#34; &#34; * table_offset + &#34;+&#34; + &#34;-&#34; * column_width * 2 + &#34;+&#34;)
                offset = len(text) // 2
                print(
                    &#34; &#34; * table_offset
                    + &#34;|&#34;
                    + &#34; &#34; * (column_width - offset)
                    + text
                    + &#34; &#34; * (column_width - (len(text) - offset))
                    + &#34;|&#34;
                )
                print(&#34; &#34; * table_offset + &#34;+&#34; + &#34;-&#34; * column_width * 2 + &#34;+&#34;)

            elif type == &#34;link&#34;:
                print(
                    &#34; &#34; * table_offset
                    + &#34;|&#34;
                    + source_sid
                    + &#34; &#34; * (column_width - len(source_sid) - 2)
                    + &#34;-&gt;&#34;
                    + &#34; &#34; * (column_width - len(target_sid))
                    + target_sid
                    + &#34;|&#34;
                )
                print(&#34; &#34; * table_offset + &#34;+&#34; + &#34;-&#34; * column_width * 2 + &#34;+&#34;)

        for schema in snapshot:
            schema_sid = schema[&#34;name&#34;]
            print_line(type=&#34;schema&#34;, text=schema_sid)

            for table in schema[&#34;tables&#34;]:
                table_sid = table[&#34;name&#34;]
                print_line(type=&#34;table&#34;, text=table_sid)

                for column in table[&#34;cols&#34;]:
                    column_sid = column[&#34;name&#34;]

                    links = column[&#34;links&#34;]

                    if links == []:
                        print_line(
                            type=&#34;link&#34;, source_sid=&#34;&#34;, target_sid=column_sid
                        )

                    else:
                        for link in links:
                            print_line(
                                type=&#34;link&#34;,
                                source_sid=self._links[link[&#34;link_id&#34;]].source_sid,
                                target_sid=self._links[link[&#34;link_id&#34;]].target_sid,
                            )

        print(&#34;\n&#34; * line_breaks)

    if how == &#34;raw&#34;:
        pprint.pprint(self.snapshot)
    elif how == &#34;pretty&#34;:
        pretty_print_snapshot()</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="flowsql.app.Objects.Schema"><code class="flex name class">
<span>class <span class="ident">Schema</span></span>
<span>(</span><span>sid: str)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Schema(Object):
    def __init__(self, sid: str):
        Object.__init__(self, sid)
        self.name = sid</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="flowsql.app.Objects.Object" href="#flowsql.app.Objects.Object">Object</a></li>
</ul>
</dd>
<dt id="flowsql.app.Objects.Table"><code class="flex name class">
<span>class <span class="ident">Table</span></span>
<span>(</span><span>sid: str, schema_sid: str)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Table(Object):
    def __init__(self, sid: str, schema_sid: str):
        Object.__init__(self, sid)
        self.schema_sid = schema_sid
        self.name = sid.split(&#34;.&#34;)[1]
        self.max_text_length = len(self.name)
        self.num_columns = 0
        self.num_children = 0
        self.num_parents = 0</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="flowsql.app.Objects.Object" href="#flowsql.app.Objects.Object">Object</a></li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="flowsql.app" href="index.html">flowsql.app</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="flowsql.app.Objects.Column" href="#flowsql.app.Objects.Column">Column</a></code></h4>
</li>
<li>
<h4><code><a title="flowsql.app.Objects.Link" href="#flowsql.app.Objects.Link">Link</a></code></h4>
</li>
<li>
<h4><code><a title="flowsql.app.Objects.Object" href="#flowsql.app.Objects.Object">Object</a></code></h4>
<ul class="">
<li><code><a title="flowsql.app.Objects.Object.object_counter" href="#flowsql.app.Objects.Object.object_counter">object_counter</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="flowsql.app.Objects.ObjectCollection" href="#flowsql.app.Objects.ObjectCollection">ObjectCollection</a></code></h4>
<ul class="two-column">
<li><code><a title="flowsql.app.Objects.ObjectCollection.add_column" href="#flowsql.app.Objects.ObjectCollection.add_column">add_column</a></code></li>
<li><code><a title="flowsql.app.Objects.ObjectCollection.add_link" href="#flowsql.app.Objects.ObjectCollection.add_link">add_link</a></code></li>
<li><code><a title="flowsql.app.Objects.ObjectCollection.add_schema" href="#flowsql.app.Objects.ObjectCollection.add_schema">add_schema</a></code></li>
<li><code><a title="flowsql.app.Objects.ObjectCollection.add_table" href="#flowsql.app.Objects.ObjectCollection.add_table">add_table</a></code></li>
<li><code><a title="flowsql.app.Objects.ObjectCollection.create_snapshot" href="#flowsql.app.Objects.ObjectCollection.create_snapshot">create_snapshot</a></code></li>
<li><code><a title="flowsql.app.Objects.ObjectCollection.print_snapshot" href="#flowsql.app.Objects.ObjectCollection.print_snapshot">print_snapshot</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="flowsql.app.Objects.Schema" href="#flowsql.app.Objects.Schema">Schema</a></code></h4>
</li>
<li>
<h4><code><a title="flowsql.app.Objects.Table" href="#flowsql.app.Objects.Table">Table</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>